<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  <!-- 모바일 풀화면/안전영역 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>EgoIdSuper</title>

  <!-- 번들 CSS: assets/ 또는 같은 폴더 둘 다 시도(404 나도 게임은 동작) -->
  <link rel="stylesheet" href="./assets/index-C9ejXq11.css">
  <link rel="stylesheet" href="./index-C9ejXq11.css">

  <style>
    /* ===== 화면(캔버스) 풀 유지 ===== */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      touch-action: none;
    }
    :root {
      /* visualViewport 기반 실제 높이(주소창/하단바 변동 대응) */
      --appH: 100vh;
      /* HUD 확대 (면적 9배 느낌 = scale 3) */
      --hudScale: 3;
      /* HUD가 너무 크면 2.6~2.8로 낮춰도 됨 */
      --hudPad: 10px;
    }
    #game-container {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: var(--appH);
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }

    /* ===== 모바일 컨트롤(조이스틱/버튼) 오른쪽 하단 유지 ===== */
    #mobile-controls-container{
      position: fixed !important;
      inset: 0 !important;
      width: 100vw !important;
      height: var(--appH) !important;
      pointer-events: none;
      z-index: 9999;
    }
    #joystick-area{
      left: auto !important;
      right: 0 !important;
      bottom: 0 !important;
      pointer-events: auto;
    }
    /* 버튼 묶음(기본은 오른쪽) */
    #mobile-skill-buttons{
      right: calc(12px + env(safe-area-inset-right)) !important;
      left: auto !important;
      pointer-events: none;
    }

    /* ===== HUD 스케일: "컨테이너만 커져서 화면 밖으로 나가는" 문제 방지 =====
       핵심: scale 적용 + (100%/scale)로 내부 좌표계를 줄여서 최종적으로 화면에 딱 맞게 확대
    */
    #ui-scale-wrapper{
      position: absolute;
      top: 0; left: 0;
      width: calc(100% / var(--hudScale));
      height: calc(100% / var(--hudScale));
      transform: scale(var(--hudScale));
      transform-origin: top left;
      pointer-events: none; /* HUD는 보통 클릭 안 함 */
      padding: var(--hudPad);
      box-sizing: border-box;
    }

    /* HUD 안의 클릭 요소가 있다면 클릭 가능하게 */
    #ui-scale-wrapper button,
    #ui-scale-wrapper [role="button"],
    #ui-scale-wrapper .pointer-events-auto{
      pointer-events: auto;
    }
  </style>
</head>

<body>
  <div id="game-container"></div>

  <script>
    // 실제 보이는 높이를 CSS 변수로 반영(주소창/하단바 변동 대응)
    (function(){
      function setAppH(){
        var h = window.innerHeight;
        if (window.visualViewport && window.visualViewport.height) h = Math.floor(window.visualViewport.height);
        document.documentElement.style.setProperty('--appH', h + 'px');
      }
      window.addEventListener('resize', setAppH, {passive:true});
      window.addEventListener('orientationchange', setAppH, {passive:true});
      if (window.visualViewport) window.visualViewport.addEventListener('resize', setAppH, {passive:true});
      setAppH();
    })();
  </script>

  <script>
    // HUD만 크게: game-ui-container가 만들어진 뒤, 모바일 컨트롤은 제외하고 나머지를 wrapper로 감싸서 스케일
    (function(){
      function wrapAndScaleUI(){
        var ui = document.getElementById('game-ui-container');
        if(!ui) return false;
        if(document.getElementById('ui-scale-wrapper')) return true;

        var wrapper = document.createElement('div');
        wrapper.id = 'ui-scale-wrapper';

        // ui의 "직접 자식" 중, mobile-controls-container는 그대로 두고 나머지는 wrapper로 이동
        var kids = Array.from(ui.children);
        kids.forEach(function(el){
          if (el && el.id === 'mobile-controls-container') return;
          wrapper.appendChild(el);
        });

        // wrapper를 맨 앞에 넣어 HUD가 위에 보이게
        ui.insertBefore(wrapper, ui.firstChild);
        return true;
      }

      // DOM 생성 타이밍 대응
      var tries = 0;
      var t = setInterval(function(){
        tries++;
        if (wrapAndScaleUI() || tries > 200) clearInterval(t);
      }, 50);
    })();
  </script>

  <!-- 번들 JS: assets/ 또는 같은 폴더 둘 다 시도 -->
  <script type="module">
    async function boot(){
      const candidates = [
        "./assets/index-CZje5KUS.js",
        "./index-CZje5KUS.js"
      ];
      for (const src of candidates){
        try{
          await import(src);
          return;
        }catch(e){
          // 다음 후보 시도
        }
      }
      // 둘 다 실패하면 사용자에게 최소 힌트(검은 화면 방지)
      const msg = document.createElement("div");
      msg.style.cssText = "position:fixed;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font:14px monospace;background:#000;z-index:99999;";
      msg.textContent = "JS 로딩 실패: index-*.js 경로를 확인해주세요 (assets/ 폴더 여부)";
      document.body.appendChild(msg);
      console.error("Failed to load game bundle from candidates.");
    }
    boot();
  </script>
</body>
</html>
